(function(){$(function(){return $.require("ready",function(){var r,t,i,a,n,e;return r=$$("#area-login"),n=$$("#form-login"),t=n.find("a.btn-login"),e=window.Worker?["ease-in","ease-out"]:["linear","linear"],a=0|$.cookie("ac_login_error")||0,a>3?($$("#form-login div.area-captcha").removeClass("hidden"),$$("#ipt-captcha-login").attr({disabled:!1}),i=!0,$$("#ipt-captcha-switch").click(function(){return $(this).prev().click()})):i=!1,n.setup({finish:function(){return $$("#ipt-captcha-login").val(""),$$("#ipt-pwd-login").on("keydown",function(r){if((13===r.which||10===r.which)&&!i)return $("#form-login a.btn.do").click()})},callback:function(){var o,c;if(i){if(o=$.trim(n.data().captcha),!o.length)return void $$("#ipt-captcha-login").info({text:"warning::请输入验证码。",direction:"bottom"}).focus()}else o=void 0;return $.info("info::登录中..."),null!=(c=system.port.login)&&c.abort(),system.port.login=$.post("/login.aspx",{username:$.trim(n.data().name),password:$.trim(n.data().password),captcha:o}).done(function(n){var o,c,s;return n.success?($.info("success::登录成功。"),$$("#area-prompt").hide(),$.user("clear"),$.preload(n.img,function(){return r.find("div.area-login a.thumb img.avatar").css({opacity:0}).attr({src:n.img}).transition({opacity:1},300)}),o=location.host.split("."),$.cookie("ac_userimg",n.img,{path:"/",expires:30,domain:"."+o[1]+"."+o[2]}),r.find("p.welcom span.username").text(n.username),c=$("#area-login .r .area-login"),c.transition({opacity:0,rotateY:180},700,e[0],function(){var t,i,a;return r.find("div.area-login").addClass("login-success"),c.transition({opacity:1,rotateY:360},700,e[1]),i=r.find("p.notice span"),t=3,system.timer.login=setInterval(function(){if(t--,i.text(t),t<=0)return clearInterval(system.timer.login)},1e3),a=system.param.returnUrl||system.hash.returnUrl||"/",setTimeout(function(){return location.href=$.parseSafe(a)},2e3)})):10776===n.errorid?($$("#area-prompt").show().find(".text").html(n.result),$$("#area-prompt").find(".txt").html("，请使用手机登录或"),void $$(".prompt-wrap").find(".icon-wrap").css("left",100)):10783===n.errorid?($$("#area-prompt").show().find(".text").html(n.result),$$("#area-prompt").find(".txt").html("，<br>请"),void $$(".prompt-wrap").find(".icon-wrap").css("left",50)):(i&&$$("#form-login div.area-captcha img.captcha-pic").click(),a++,$.cookie("ac_login_error",a,{expires:1}),(a>3||n.result.search("captcha")!==-1)&&($$("#form-login div.area-captcha").removeClass("hidden"),$$("#ipt-captcha-login").attr({disabled:!1}),i||setTimeout(function(){return location.reload()},1e3),i=!0),n.result.search("captcha")!==-1?(a<=3&&(a=4,$.cookie("ac_login_error",a,{expires:1})),$.info(s="warning::请输入验证码。"),$$("#ipt-captcha-login").info(s)):($.info(s="warning::"+n.result),t.info(s)))}).fail(function(){var r;return $.info(r="error::通信失败。请稍后重试。"),t.info(r)})}}),$$("#contractServer").click(function(){return $$(".prompt-wrap").fadeIn()}),$$("#close-prompt").click(function(){return $$(".prompt-wrap").fadeOut()})})})}).call(this);