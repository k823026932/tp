$(function(){function a(a,e,t){var n="";n=null==$.user.uid?0:$.user.uid,window.sa&&sa.track(a,{product:"web",UID:String(n),channel:$.getQueryString("channel")||"",userLevel:String($.user.level),client:"Web",refer_code:e,page:t})}function e(a){a=a?a:window.event?window.event:null;var e=t();if("IE"==e){var n=a.clientY||a.target.event.clientY,i=a.altKey||a.target.event.altKey;(0>n||i)&&window.ChatRoomID&&AcfunChat.events.publish("quiteRoom",{roomInfo:window.ChatRoomID,isRefresh:!0})}else{var o=a.currentTarget.document.activeElement.nodeName;"A"!=o&&window.ChatRoomID&&AcfunChat.events.publish("quiteRoom",{roomInfo:window.ChatRoomID,isRefresh:!0})}}function t(){var a=navigator.userAgent,e=a.indexOf("Opera")>-1;return e?"Opera":a.indexOf("Firefox")>-1?"FF":a.indexOf("Chrome")>-1?"Chrome":a.indexOf("Safari")>-1?"Safari":a.indexOf("compatible")>-1&&a.indexOf("MSIE")>-1&&!e?"IE":void 0}$(".block-video .has-danmu").showDanmu(),$(".module-video-big .has-danmu").showDanmu({lines:5,lineHeight:30});var n,i=function(a,e,t){var n=a,i=n.data().nav,o=n.closest("[data-tab]");e&&e(),n.addClass("active").siblings("a").removeClass("active"),o.find("[data-con]").addClass("hidden").filter('[data-con="'+i+'"]').removeClass("hidden")};$("[data-nav]").click(function(){var a=$(this),e=a.data().nav,t=a.closest("[data-tab]");t.hasClass("module-article")?i(a,function(){if(a.hasClass("active")){var t="/v/list"+e+"/index.htm";t=window.globalConfig.rootDomain?window.globalConfig.rootDomain+t:t,a.attr("href",t).attr("target","_blank")}else a.attr("href","javascript:;").removeAttr("target")}):i(a)}),$(".area-banana-rank .column-right .module-tab").on("mouseenter","a",function(){var a=$(this),e=a.data().nav,t=a.closest("[data-tab]");clearTimeout(n),n=setTimeout(function(){t.hasClass("module-article")?i(a,function(){if(a.hasClass("active")){var t="/v/list"+e+"/index.htm";t=window.globalConfig.rootDomain?window.globalConfig.rootDomain+t:t,a.attr("href",t).attr("target","_blank")}else a.attr("href","javascript:;").removeAttr("target")}):i(a)},150)});var o=$("#slider-big"),r=o.find(".slider-item"),d=o.find(".slider-con"),c=r.length;if(c>1){for(var s="",l=0;c>l;l++)s+="<span>"+(l+1)+"</span>";o.append('<div class="slider-count">'+s+"</div>");var f,h=0,u=function(a){var e=r.width();d.width(r.width()*c),d.animate({left:-e*a}),o.find(".slider-count span").eq(a).addClass("active").siblings("span").removeClass("active")},m=function(){f=setInterval(function(){u(h),h>=c-1?h=0:h++},3e3)};u(0),m(),o.hover(function(){clearInterval(f)},function(){h>=c-1?h=0:h++,m()}),o.on("click",".slider-count span",function(){h=$(this).index(),u(h)})}window.sa&&sa.track("HomePage",{from:document.referrer,firstPage:window.saObj.isFirstPage}),$(".J_niudannav").off("click").on("click",function(){a("web_click","web_home_navigation_gashapon","page_home")}),$(".J_niudan").off("click").on("click",function(){a("web_click","web_videodetai_svideodetail_gashapon","page_videodetail")});var g=function(){var a=$("#temp-change-video").html(),e=$(a).addClass("[recommendClass]");return e[0].outerHTML}();$(".area-change-btn span").click(function(){var a=$(this),e=a.closest(".area-channel"),t=e.find(".module-video"),n=e.attr("data-cid"),i=t.attr("data-pagecount"),o=parseInt(t.attr("data-showlength")),r=e.find("script.json-channel-change"),d=e.find("script.json-channel-adlist"),c=a.closest(".area-change-btn"),s=50;if(c.hasClass("loading"))return!1;a.data().page=a.data().page||0,a.data().recommendData=$.parseJson(e.find("script.json-channel-recommend").html())||[],a.data().recommendData=$.parseJson(e.find("script.json-channel-recommend").html())||[],a.data().recommendPage=void 0==a.data().recommendPage?0:a.data().recommendPage,a.data().changeData=a.data().changeData||[],a.data().changeDataOld=$.parseJson(r.html())||[],a.data().adList=$.parseJson(d.html())||[],a.data().changeStart=a.data().changeStart||0;var l={start:function(){c.addClass("loading")},stop:function(){setTimeout(function(){c.removeClass("loading")},1e3)}};l.start();var f=function(){var e=a.data().recommendPage,t=a.data().recommendData.slice(e*i,(e+1)*i);return t.length<=0&&(a.data().recommendPage=0,e>0&&(t=f())),t};a.data().recommendPage+=1;var h=function(){var e=f(),t=[],n=o-e.length,i=a.data().changeStart+n,r=a.data().changeData.slice(a.data().changeStart,i),d=a.data().adList,c=n-r.length;if(c>0){if(!a.data().lock)return v(function(){m()}),!1;var s=a.data().changeData.slice(0,c);r=r.concat(s),i=c}return a.data().changeStart=i,e=e.concat(r).sort(function(){return Math.random()>.5?-1:1}),t=u(e,d)},u=function(a,e){for(var t,n=[],i=(a.slice(0,a.length),a.length),o=0;o<e.length;o++)t=e[o],t&&t.adRank&&(n[t.adRank-1]=t);a=a.filter(function(a){return a&&a.adRank>0?!1:!0});for(var r=0;i>r;r++)n[r]||(n[r]=a.shift());return n},m=function(){var a=h();if(a){var e="";$.each(a,function(a,t){t&&(t.isCrown&&(t.recommendClass=t.isCrown?"is-recommend":""),e+=$.parseTemp(g,t))}),t.html(e),t.find("img[data-original]").lazyload({threshold:200,effect:"fadeIn",failure_limit:50}),l.stop()}},v=function(e){$.getHttp("/index/change",{channelId:n,page:a.data().page+1},function(t){var n=t.data,i=n.hits,o=[];n.total<s?(a.data().lock=!0,o=$.removeRepeatObject(a.data().changeDataOld,i,"videoId"),o=o.concat(a.data().changeDataOld)):o=i,a.data().page=a.data().page+1,o=$.removeRepeatObject(a.data().recommendData,o,"videoId");var r=[];r=1==a.data().page?a.data().changeDataOld:a.data().changeData,o=$.removeRepeatObject(r,o,"videoId"),a.data().changeData=a.data().changeData.concat(o),e&&e()},function(){l.stop(),$.info.error("获取数据失败!")})};m()}),$(".indexMonkeyRightAd").click(function(){window.sa&&sa.track("JD618_PC")});var v=function(){var a,e,t,n,i,o=12,r=$("#christmas .close-btn");i=function(){$("#christmas").hide(),localStorage.christmasDefault=1},r.on("click",function(){i()}),a=Date.parse(new Date),e=14825808e5,t=14826816e5,1!=localStorage.christmasDefault&&parseInt(a)>e&&parseInt(a)<t&&$("#christmas").show(),(n=function(a){r.html("跳过动画("+a+")"),0==a?i():(setTimeout(function(){n(a)},1e3),a--)})(o)};v(),$(document).ready(function(){$.ajax({type:"get",url:"http://webapi.acfun.cn/chatroom/usersig?_="+(new Date).getTime(),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).done(function(a){if(200==a.code){if(""==a.data.usersig)return;window.localStorage.chatStoreKey=a.data.identifier;var e=a.data.identifier,t=a.data.usersig;$.cookie("identifier",e),$.cookie("usersig",t),$("#J_chat_btn").show()}else $("#J_chat_btn").remove()})}),window.onbeforeunload=function(a){try{return e(a)}catch(t){}}});