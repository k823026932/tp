$(function(){function a(a,t,e){var i="";i=null==$.user.uid?0:$.user.uid,window.sa&&sa.track(a,{product:"web",UID:String(i),channel:$.getQueryString("channel")||"",userLevel:String($.user.level),client:"Web",refer_code:t,page:e})}var t=0,e=function(a,t,e){var i=a,l=i.data().nav,o=i.closest("[data-tab]");t&&t(),i.addClass("active").siblings("a").removeClass("active"),o.find("[data-con]").addClass("hidden").filter('[data-con="'+l+'"]').removeClass("hidden")};console.log($("#temp-list-video").html());var i=null;if($(".labels [data-tag]").click(function(){var a=$(this);e(a),i=a.data().tag;var t={sort:o,pageNo:1};myShowList(t),c(),$('.module-tab [data-nav="1"]').addClass("active").siblings("a").removeClass("active")}),$.nowNum=1,location.href.indexOf("#page=")>0){var l=location.href.match(/#page=(\d+)/)[1];isNaN(l)||($.nowNum=parseInt(l))}var o=0;$(".list-tab [data-nav]").click(function(){o=$(this).data().nav,0!=o?$(".area-date").css({display:"block"}):($(".area-date").css({display:"none"}),$(".area-calendar").css({display:"none"}));var a=$(this);e(a),myShowList({sort:o,pageNo:1})}),$(".module-tab [data-nav]").click(function(){var a=$(this);e(a)}),window.localStorage.setItem("color","default");var s=$("#third-view").children("a");if("th-large"==s.data().th){var n=window.localStorage.getItem("color");$("#third-view [data-th ='th-large']").addClass(n)}var d=$("#list-data");s.click(function(){var a=$(this);a.hasClass("default")||(s.filter(".default").removeClass("default"),a.addClass("default"),a.hasClass("default")&&"th-large"===a.data().th?window.localStorage.setItem("className","th-large"):a.hasClass("default")&&"th-list"===a.data().th?window.localStorage.setItem("className","th-list"):window.localStorage.setItem("className","th-normal"),add())}),add=function(){var a=window.localStorage.getItem("className");$("#third-view [data-th ='th-large']").removeClass(n),"th-list"==a?(d.removeClass("th-large th-normal").addClass(a),$("#third-view [data-th ='th-list']").addClass(n)):"th-normal"==a?(d.removeClass("th-large th-list").addClass(a),$("#third-view [data-th ='th-normal']").addClass(n)):(d.removeClass("th-normal th-list").addClass(a),$("#third-view [data-th ='th-large']").addClass(n))},add(),forDate=function(a){var t=a.split("-"),e=new Date(t[0],t[1]-1,t[2]).getTime();return e};var r=86399e3;myShowList=function(a){i&&(a.tagIds=i),0!=o&&(a.startDate=forDate($(".area-start-date").html()),a.endDate=forDate($(".area-end-date").html())+r),$("#list-video").html("<div id='emotion'><img src='"+window.globalConfig.oldPath+"/umeditor/dialogs/emotion/images/ac/"+$.randomNumber(1,54)+".gif'/><div id='list'>正在获取视频列表...</div></div>");var e,l;e={channelId:location.href.match(/\/[v|a]\/list(\d+)/)[1],sort:o,pageSize:20,pageNo:a.pageNo||1};var s=e.channelId;l=$.extend({},e,a),$.ajax({type:"GET",url:"/list/getlist",data:l,dataType:"json",success:function(a){if(a.data.data.length>0){var e="";$.each(a.data.data,function(a,t){switch(t.verified){case 1:t.verifiedTitle="AcFun管理员";break;case 2:t.verifiedTitle="AcFun官方认证";break;default:t.verifiedTitle=""}if((98==s||100==s||121==s||141==s)&&t&&t.link&&t.link.indexOf("v/ac")>=0){var i="http://pass.hapame.com/reload.aspx?redirect_url="+encodeURI("http://v.hapame.com"+t.link.replace("v/ac","video/id"));const l=$.cookie("auth_key")||"",o=$.cookie("auth_key_ac_sha1")||"",n=$.cookie("auth_key_ac_sha1_")||"";i+="&ukey="+l+"&checkold="+o+"&checknew="+n,t.link=i}e+=$.parseTemp($("#temp-list-video").html(),t)}),$("#list-video").html(e).find("img[data-original]").lazyload({threshold:200,effect:"fadeIn"}),a.data.params.num!=$.nowNum&&($.nowNum=a.data.params.num);var l=$.makePager({num:$.nowNum,count:a.data.params.totalCount,size:a.data.params.pageSize,total:a.data.params.pageCount,addon:!0});$("#list-pager").html(l),0==t&&($("#list-pager").readyPager({addon:!0,callback:function(a){return console.log(i),myShowList({pageNo:a})}}),t=1)}else $("#emotion div").html("暂无内容."),$("#list-pager").html(" ");scroll(0,0)},error:function(){$("#emotion div").html('<p class="alert info danger">获取视频列表失败，请于稍后重试。</p>'),$("#list-pager").html(" ")}})};var c=function(a){var t={channelId:location.href.match(/\/[v|a]\/list(\d+)/)[1],sort:1,range:1,page:1,size:5,tagIds:i};$.ajax({type:"GET",url:"/list/getrank",data:t,dataType:"json",success:function(a){$(".module-main").html(a.data).find("img[data-original]").lazyload({threshold:200,effect:"fadeIn"})}})};getData($.nowNum),$(".list-right-img").on("click",function(){sa.track("SanJiYeGuangGao",{channel:$.getvl("channel")||"",userLevel:$.user.getGroupLevel()?String($.user.getGroupLevel()):"-1",url:$(this).find("a").attr("href"),secchannelId:Number(location.pathname.split("list")[1].split("/")[0])})}),$(".J_niudannav").off("click").on("click",function(){a("web_click","web_home_navigation_gashapon","page_home")}),$(".J_niudan").off("click").on("click",function(){a("web_click","web_videodetai_svideodetail_gashapon","page_videodetail")});var h=function(){var a=location.pathname.split("/"),t="";if(a&&a.length>=3&&(t=a[2]),console.log(t),"list100"==t||"list121"==t||"list141"==t||"list98"==t||"list179"==t){$("a").each(function(a,t){var e=$(t);if(e)try{var i=e.attr("href");if(i&&i.indexOf("video/id")>0&&i.indexOf("checkold")<0){console.log(i);var l=$.cookie("auth_key")||"",o=$.cookie("auth_key_ac_sha1")||"",s=$.cookie("auth_key_ac_sha1_")||"",n="&ukey="+l+"&checkold="+o+"&checknew="+s;e.attr("href",i+n)}}catch(d){}})}};h()});