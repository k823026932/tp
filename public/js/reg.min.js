(function(){$.fn.popupCode=function(e){var t,i;return t=($$(window).width()-316)/2,i=($$(window).height()-300)/2,$(document).unfold({src:"../html/win-verificationcode",id:"win-verifycode",title:"验证码",width:"316",height:"auto",top:i,left:t,curtain:!0,callback:function(){return $.fn.popupCodeConfirm(function(t,i){return"function"==typeof e?e(t,i):void 0})}})},$(function(){return $.require("ready",function(){var e,t,i,n,r;return i="",t=!1,$("#inp").val($.cookie("ac_sid")),e=$$("#form-reg"),r=function(){var t;return t=$("#send-mobile-code"),t.removeClass("dis").removeAttr("disabled").off("click").on("click",function(){return $.fn.popupCode(function(a,o){return $.get(i+"/mobileValidate.aspx?mobile="+e.data().mobile+"&captcha="+a).done(function(e){var i,a;return e.success?(n(),$.info("success::"+e.info),t.val("重新发送( 60 )"),i=60,a=setInterval(function(){if(t.val("重新发送( "+--i+" )"),i<0)return clearInterval(a),t.val("发送验证码"),r()},1e3),"function"==typeof o?o():void 0):"function"==typeof o?o(e.info):void 0}).fail(function(e){return $.info("error::网络错误")})})})},n=function(){var e;return e=$("#send-mobile-code"),e.off("click").addClass("dis").attr("disabled","disabled")},function(){var e;if("1"===$.query().mini)return e=$$(".after-reg").find("a"),e.html("稍后自动返回来源页面").attr("href",$.query().href)}(),e.data().submit=function(){var t;return null!=(t=e.data().port)&&t.abort(),e.data().port=$.post(i+"/mobileRegister.aspx",{username:e.data("username"),mobile:e.data().mobile,code:e.data().mcode,username:e.data().regname,password:e.data().password,password2:e.data("re-password")},"json").done(function(t){var i,n;return $("#curtain").click(),t.success?($.info(n="success::"+t.result),e.addClass("hidden"),i=$("#area-reg .area-reg"),i.find(".after-reg").removeClass("hidden").find(".mobile").text(e.data().mobile+","),i.transition({translate:"0,90"},1e3),setTimeout(function(){return"1"===$.query().mini?window.location.href=$.query().href+"#answer=1":window.location.href="/"},3e3)):($.info(n="warning::"+(t.result||"操作失败。")),$$("#ipt-mobile-code").val(""))}).fail(function(){var t;return $.info(t="error::因网络原因注册失败，请稍后重试。"),e.info(t),e.find("div.area img.captcha-pic").click(),$$("ipt-captcha-reg").val("")})},system.regable||(e.find(".area-code").removeClass("hidden"),$$("#ipt-code-reg").attr({disabled:!1})),e.setup({finish:function(){return $$("#ipt-mobile-reg").focus(),$$("#ipt-mobile-reg, #ipt-username-reg").on("blur",function(){var e,t;if(e=$(this),!e.hasClass("error"))return t="手机号码"===e.data().name?"mobile":"username","mobile"===t?$.get(i+"/mobileUnique.aspx?"+t+"="+e.val()).done(function(t){return t?(r(),e.data({exist:!1})):(e.addClass("error").data({exist:!0}).info({text:"warning::手机号码已被注册。",direction:"right"}),e.data({exist:!0}))}).fail(function(){return e.data({exist:!1})}):$.get(i+"/username_unique.aspx?"+t+"="+encodeURIComponent(e.val())).done(function(t){return 200===t.status?e.data({exist:!1}):400===t.status?(e.addClass("error").data({exist:!0}).info({text:"warning::"+t.info,direction:"right"}),e.data({exist:!0})):void 0}).fail(function(){return e.data({exist:!1})})})},callback:function(){return $$("#ipt-mobile-code").data().exist?void $$("#ipt-mobile-code").info({text:"warning::手机验证码错误。",direction:"right"}):$$("#ipt-username-reg").data().exist?void $$("#ipt-username-reg").info({text:"warning::账号已被注册。",direction:"right"}):$$("#ipt-agree-reg")[0].checked?$$("#form-reg").data().submit():void $$("#ipt-agree-reg").info({text:"warning::注册账号需同意《使用协议》。",direction:"top"})}})})})}).call(this);