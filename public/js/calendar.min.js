$(function(){function e(e,t){t=parseInt(t,10);var a=new Date(e,t,0);return a.getDate()}function t(t){var a=(new Date).getFullYear(),i=(new Date).getMonth()+1;if(a>t)$(".btn-mouth").addClass("active").removeClass("disable"),c.on("click",function(){var t,a,i;t=$(this),c.removeClass("thisMouth"),t.addClass("thisMouth"),i=(new Date).getFullYear(),a=n.datepicker("getDate").getFullYear(),a>=i?t.data().month>(new Date).getMonth()+1&&(i-=1):i=a,n.datepicker("setDate",new Date(a,t.data().month-1,1)),changeDateBtnActive(n.datepicker("getDate").getTime());var s=e(i,t.data().month);r.datepicker("setDate",new Date(a,t.data().month-1,s)),$(".calendar-sure").click()});else{var s=$(".unit-mouth").find(".thisMouth");s.attr("data-month")>i&&changeDateBtnActive((new Date).getTime());for(var d=0;d<$(".btn-mouth").length;d++)if($(".btn-mouth").eq(d).attr("data-month")==i){var o=$(".btn-mouth").eq(d);o.siblings(".btn-mouth").removeClass("active"),o.next().prevAll().addClass("active")}else if($(".btn-mouth").eq(d).attr("data-month")>i){$(".btn-mouth").eq(d).addClass("disable");var l=$(".unit-mouth").find(".disable");l.off("click")}}}var a=$(".area-calendar"),n=$("#calendar-start-date"),r=$("#calendar-end-date"),i=$(".area-date-list .area-start-date"),s=$(".area-date-list .area-end-date"),d=$("#list-data"),o=new Date,c=$(".btn-mouth"),l=$(".btn-year"),D=(o.getMonth(),o.getFullYear()),g=window.sessionStorage.getItem("dateStart"),h=window.sessionStorage.getItem("endStart");g?d.data({startDate:new Date(g).getTime(),endDate:new Date(h).getTime()}):d.data({startDate:(new Date).getTime()-7776e6});for(var m=l,u=j=0,w=m.length;j<w;u=++j)v=m[u],l.eq(u).text(D+u+1-l.length).data({year:D+u+1-l.length});changeDateBtnActive=function(e){var t,a,n;return t=e,a=new Date(t).getMonth(),c.removeClass("thisMouth").eq(a).addClass("thisMouth"),n=new Date(t).getFullYear()-o.getFullYear()+2,l.removeClass("thisYear"),n>=0?l.eq(n).addClass("thisYear"):void 0},$(".calendar-sure").on("click",function(){var e,o,c,l;e=n.datepicker("getDate").getTime(),o=r.datepicker("getDate").getTime(),e>o?(l=o,c=e):(l=e,c=o),d.data({startDate:l,endDate:c}),i.text(n.val()),s.text(r.val()),changeDateBtnActive(d.data().startDate),t(new Date(n.val()).getFullYear()),a.css({display:"none"}),getData(1)}),c.on("click",function(){var t,a,i;t=$(this),c.removeClass("thisMouth"),t.addClass("thisMouth"),i=(new Date).getFullYear(),a=n.datepicker("getDate").getFullYear(),a>=i?t.data().month>(new Date).getMonth()+1&&(i-=1):i=a,n.datepicker("setDate",new Date(i,t.data().month-1,1)),changeDateBtnActive(n.datepicker("getDate").getTime());var s=e(i,t.data().month);r.datepicker("setDate",new Date(i,t.data().month-1,s)),$(".calendar-sure").click()}),t(g?new Date(g).getFullYear():(new Date).getFullYear()),l.on("click",function(){var a,i;a=$(this),t(a.text()),l.removeClass("thisYear"),a.addClass("thisYear"),i=n.datepicker("getDate"),n.datepicker("setDate",new Date(a.data().year,new Date(i).getMonth(),new Date(i).getDate()));var s=e(a.data().year,new Date(i).getMonth()+1)-1;r.datepicker("setDate",new Date(new Date(a.data().year,new Date(i).getMonth(),new Date(i).getDate()).getTime()+24*s*60*60*1e3))}),onSelect=function(){return function(e,t){var a;Math.abs(r.datepicker("getDate").getTime()-n.datepicker("getDate").getTime())>26784e5&&(a=t.input.datepicker("getDate"),"calendar-start-date"===t.id?r.datepicker("setDate",new Date(a.getTime()+26784e5)):n.datepicker("setDate",new Date(a.getTime()-26784e5)))}},n.datepicker({constrainInput:!0,defaultDate:"-1w",minDate:new Date(2007,5,1),maxDate:"+2m",gotoCurrent:!0,changeMonth:!0,changeYear:!0}).datepicker("setDate",new Date(d.data().startDate)),r.datepicker({constrainInput:!0,minDate:new Date(2007,5,1),maxDate:"+2m",gotoCurrent:!0,changeMonth:!0,changeYear:!0}).datepicker("setDate",new Date(d.data().endDate)),$(".area-date-list").click(function(){a.css({display:"block"}),n.val(i.html()),r.val(s.html()),changeDateBtnActive(n.datepicker("getDate").getTime())}),a.find(".close").click(function(){a.css({display:"none"})}),getData=function(e){newS=n.val(),newE=r.val(),i.html(newS),s.html(newE),window.sessionStorage.setItem("dateStart",newS),window.sessionStorage.setItem("endStart",newE),newS=forDate(newS),newE=forDate(newE),myShowList({pageNo:e})}});